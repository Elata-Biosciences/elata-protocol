#!/bin/bash
# Pre-commit hook for Foundry projects
# This ensures code is formatted and builds before committing

set -e

echo "ğŸ” Running pre-commit checks..."

# Check if forge is installed
if ! command -v forge &> /dev/null; then
    echo "âŒ Forge is not installed. Please install Foundry first."
    exit 1
fi

# 1. Format check and auto-fix
echo "ğŸ“ Checking and fixing code formatting..."
if ! forge fmt; then
    echo "âŒ Formatting failed!"
    exit 1
fi

# Stage any formatting changes
git add -u

# 2. Build check
echo "ğŸ”¨ Building contracts..."
if ! forge build --sizes; then
    echo "âŒ Build failed!"
    exit 1
fi

# 3. Run quick tests (only on changed files if possible)
echo "ğŸ§ª Running tests..."
if ! forge test --silent; then
    echo "âŒ Tests failed! Run 'forge test -vv' to see details."
    exit 1
fi

echo "âœ… All pre-commit checks passed!"

